<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Puzzle Mega Difícil</title>
<style>
  body {
    background-color: #000000;
    font-family: monospace;
    color: white;
    text-align: center;
    padding: 2em;
  }
  canvas {
    border: 2px solid white;
    margin-top: 20px;
  }
  #colorPicker {
    margin-top: 20px;
    padding: 8px;
  }
  .pista {
    font-style: italic;
    color: #ccc;
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<h1>¿Cuál es la serie favorita de Rokio?</h1>
<p class="pista">"Solo la luz correcta revelará el secreto."</p>

<label for="colorPicker">Elige el color de fondo:</label>
<input type="color" id="colorPicker" value="#000000" />

<canvas id="canvas" width="900" height="300"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const colorPicker = document.getElementById("colorPicker");

const options = [
  { text: "SMILING FRIENDS", x: 20, y: 60, colorPattern: ['r','g','b','r','g','b','r','g','b','r','g','b','r','g','b'] },
  { text: "HORA DE AVENTURAS", x: 20, y: 110, colorPattern: ['b','r','g','b','r','g','b','r','g','b','r','g','b','r','g','b','r','g'] },
  { text: "HOUSE", x: 20, y: 160, colorPattern: ['g','b','r','g','b'] },
  { text: "SOUTH PARK", x: 20, y: 210, colorPattern: ['r','b','g','r','b','g','r','b','g','r'] },
  { text: "FARGO", x: 500, y: 60, colorPattern: ['b','g','r','b','g'] },
  // Esta es la correcta: combinación diseñada para volverse brillante con un fondo específico
  { text: "MORAL OREL", x: 500, y: 110, colorPattern: ['g','b','g','b','g','b','g','b','g','b'] }
];

// Función para obtener rgb desde código 'r','g','b'
function getRGB(colorCode) {
  switch(colorCode) {
    case 'r': return [255,0,0];
    case 'g': return [0,255,0];
    case 'b': return [0,0,255];
    default: return [255,255,255];
  }
}

// Mezcla aditiva simple para saber contraste
// Retorna el brillo resultante de sumar el fondo y la letra (simplificado)
function additiveMix(bg, fg) {
  // Normalizamos a 0..1
  let r = Math.min(1, bg[0]/255 + fg[0]/255);
  let g = Math.min(1, bg[1]/255 + fg[1]/255);
  let b = Math.min(1, bg[2]/255 + fg[2]/255);
  // brillo simple como media
  return (r + g + b) / 3;
}

function draw() {
  const bgColor = colorPicker.value;
  document.body.style.backgroundColor = bgColor;

  // convertir bg hex a rgb array
  const bgRGB = hexToRgb(bgColor);

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.font = "22px monospace";
  ctx.textBaseline = "middle";

  for(const opt of options) {
    for(let i=0; i < opt.text.length; i++) {
      const letter = opt.text[i];
      const colorCode = opt.colorPattern[i % opt.colorPattern.length];
      const fgRGB = getRGB(colorCode);
      const brightness = additiveMix(bgRGB, fgRGB);

      // Para que solo la opción correcta se vea clara cuando la mezcla es alta,
      // hacemos que la opacidad sea proporcional al brillo. Así letras “se revelan”
      // en función del fondo y el color del texto.
      let alpha = 0;
      if (opt.text === "MORAL OREL") {
        // opción correcta: opacidad proporcional al brillo (se ve con fondo adecuado)
        alpha = brightness;
      } else {
        // opciones incorrectas, letras casi invisibles (opacidad muy baja) incluso con fondo blanco
        alpha = brightness > 0.6 ? 0.1 : brightness * 0.2;
      }

      ctx.fillStyle = `rgba(${fgRGB[0]},${fgRGB[1]},${fgRGB[2]},${alpha})`;
      ctx.fillText(letter, opt.x + i * 18, opt.y);
    }
  }
}

// Convierte hex #RRGGBB a [R,G,B]
function hexToRgb(hex) {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? [
    parseInt(result[1], 16),
    parseInt(result[2], 16),
    parseInt(result[3], 16)
  ] : [0,0,0];
}

colorPicker.addEventListener("input", draw);

// Dibujar inicial
draw();
</script>

</body>
</html>
